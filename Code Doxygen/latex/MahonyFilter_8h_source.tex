\doxysection{Mahony\+Filter.\+h}
\hypertarget{MahonyFilter_8h_source}{}\label{MahonyFilter_8h_source}\index{/home/tony/Github/SkyPulseUAV/SkyPulseUAV\_Device/include/MahonyFilter.h@{/home/tony/Github/SkyPulseUAV/SkyPulseUAV\_Device/include/MahonyFilter.h}}
\mbox{\hyperlink{MahonyFilter_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ \_\_MAHONY\_FILTER\_H\_\_}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ \_\_MAHONY\_FILTER\_H\_\_}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{CppThread_8hpp}{CppThread.hpp}}"{}}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{MPU6050_8h}{MPU6050.h}}"{}}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#define\ sampleFreq\ \ 200.0f\ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ sample\ frequency\ in\ Hz}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ twoKpDef\ \ \ \ (2.0f\ *\ 0.05f)\ \ }\textcolor{comment}{//\ 2\ *\ proportional\ gain}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#define\ twoKiDef\ \ \ \ (2.0f\ *\ 0.001f)\ }\textcolor{comment}{//\ 2\ *\ integral\ gain}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classMahonyFilter}{MahonyFilter}}\ \{}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classMahonyFilter_aa0328404826e67b40a05527200b30178}{CallbackFunction}}\ =\ std::function<void(\textcolor{keywordtype}{float},\ \textcolor{keywordtype}{float},\ \textcolor{keywordtype}{float},\ \textcolor{keywordtype}{float}[3])>;}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \ \ \mbox{\hyperlink{classMahonyFilter_a538ff4e224632f1c596032eb924e458a}{MahonyFilter}}();}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \ \ \ \ \mbox{\hyperlink{classMahonyFilter_a538ff4e224632f1c596032eb924e458a}{MahonyFilter}}(\textcolor{keywordtype}{float}\ filterSample,\ \textcolor{keywordtype}{float}\ twoPropGain,\ \textcolor{keywordtype}{float}\ twoInteGain);}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_a06075064f78d34b1e0dac58d3fde5b69}{getAngle}}(\textcolor{keywordtype}{float}*\ roll,\ \textcolor{keywordtype}{float}*\ pitch,\ \textcolor{keywordtype}{float}*\ yaw,\ \textcolor{keywordtype}{float}\ g[3]);}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_ae67f6e8e68825946017b5739b7a9d892}{getAngleRate}}(\textcolor{keywordtype}{float}\ g[3]);}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{comment}{//void\ getQuaternion(float\ q\_new[4]);}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_a957ba96b767f0773570b96956c17990e}{setFrequency}}(\textcolor{keywordtype}{float}\ f);}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_a53498fc7db9a8a4c1d4fa8a8e2c1c379}{readRawData}}(\textcolor{keywordtype}{float}\ a[3],\ \textcolor{keywordtype}{float}\ g[3],\ \textcolor{keywordtype}{float}\ m[3]);}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_a3aa55af4a747f73e816cc360b61da9a2}{MahonyAHRSupdate}}();}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_a114a0d4371008b619d0ffa0358e67386}{MahonyAHRSupdateIMU}}();}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMahonyFilter_aa9b0fc66938f28ddc5e971c88963e7af}{isDataReady}}();}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{comment}{//\ bool\ checkFilterReady\_A();}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{comment}{//\ bool\ checkFilterReady\_B();}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{//\ void\ resetFilterReady();}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_af3d9be453283a9c601eae221c39f12fe}{setCallbackA}}(\mbox{\hyperlink{classMahonyFilter_aa0328404826e67b40a05527200b30178}{CallbackFunction}}\ callback);}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_ae5b7e27bed8b418bd49d177983cc4a7a}{setCallbackB}}(\mbox{\hyperlink{classMahonyFilter_aa0328404826e67b40a05527200b30178}{CallbackFunction}}\ callback);}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ std::array<float,\ 3>\ \mbox{\hyperlink{classMahonyFilter_a90e8fa9e947187ef9b37ac1525d6a32f}{getAngleTest}}();}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classMahonyFilter_a820c22532887b315ebacfce778e45b54}{invSqrt}}(\textcolor{keywordtype}{float}\ x);}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_a783f9dbed3b3d47b14b91dcb44bfaddb}{setKi}}(\textcolor{keywordtype}{float}\ twokiSet);}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilter_afeb3736941b1ebe1cc655ce52be8d071}{setKp}}(\textcolor{keywordtype}{float}\ twokpSet);}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \mbox{\hyperlink{classMahonyFilter_aa0328404826e67b40a05527200b30178}{CallbackFunction}}\ callbackA\_;}
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classMahonyFilter_aa0328404826e67b40a05527200b30178}{CallbackFunction}}\ callbackB\_;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{float}\ twoKp;}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{float}\ twoKi;}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordtype}{float}\ q[4];}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{float}\ ax,\ ay,\ az;}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordtype}{float}\ gx,\ gy,\ gz;}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{float}\ mx,\ my,\ mz;}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ std::atomic<float>\ gx\_out;}
\DoxyCodeLine{00074\ \ \ \ \ std::atomic<float>\ gy\_out;}
\DoxyCodeLine{00075\ \ \ \ \ std::atomic<float>\ gz\_out;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{float}\ frequency;}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordtype}{float}\ integralFBx;\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{float}\ integralFBy;}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{float}\ integralFBz;}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ std::atomic<float>\ roll;}
\DoxyCodeLine{00083\ \ \ \ \ std::atomic<float>\ pitch;}
\DoxyCodeLine{00084\ \ \ \ \ std::atomic<float>\ yaw;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{bool}\ mpu\_data\_ready;}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ Two\ flags\ for\ two\ interfaces\ with\ different\ frequencies.}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordtype}{bool}\ filter\_ready\_A;\ }
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{bool}\ filter\_ready\_B;}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \};}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classMahonyFilterThread}{MahonyFilterThread}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classCppThread}{CppThread}}\ \{}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classMahonyFilterThread_a948b6d4108526d9c1f56353d799cee1d}{MahonyFilterThread}}(\mbox{\hyperlink{classMahonyFilter}{MahonyFilter}}\&\ MahonyFilterIns\_,\ \mbox{\hyperlink{classMPU6050}{MPU6050}}\&\ MPU6050Ins\_)\ :\ }
\DoxyCodeLine{00099\ \ \ \ \ MahonyFilterIns(MahonyFilterIns\_),}
\DoxyCodeLine{00100\ \ \ \ \ MPU6050Ins(MPU6050Ins\_)\ \{\};}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMahonyFilterThread_ade2008bafb60e46b407bf838bd0b4fc2}{run}}()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{classMahonyFilter}{MahonyFilter}}\&\ MahonyFilterIns;}
\DoxyCodeLine{00109\ \ \ \ \ \mbox{\hyperlink{classMPU6050}{MPU6050}}\&\ MPU6050Ins;}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \};}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
